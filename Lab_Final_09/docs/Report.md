# Итоговый отчет по лабораторной работе
**Тема:** Разработка JSON-парсера и системы учета посещаемости.
**ФИО:** Камалова Елизавета Константиновна
**Группа:** ФМИАТ МОАИС 25/01

---

## 1. Введение
В рамках работы было создано приложение для анализа логов посещаемости. Главной технической сложностью являлась реализация парсера JSON с нуля и обеспечение корректной работы с кириллицей (UTF-8) в среде Windows. А так же сложности вызвали, что в Windows слова IN и OUT зарезервированы. А в задании типы посещения называются IN и OUT. Без этого блока программа не скомпилируется, выдавая странные ошибки.

**Среда выполнения:**
- OS: Windows 10/11 x64.
- Компилятор: MSVC (Visual Studio 2022).
- Настройки: C++20, флаг `/utf-8`.

## 2. Структура проекта и данных
Проект разделен на 4 подпроекта в одном решении для изоляции ответственности:
- `simple_json`: Ядро парсинга.
- `attendance`: Бизнес-логика.
- `utils`: Вспомогательные функции (IO, Encoding).

**Схема данных (JSON):**
```json
[
  {
    "student": "Иванов И.И.",    // Строка, UTF-8
    "ts": "2025-10-01T08:00:00Z", // ISO 8601
    "type": "in"                 // enum: in, out, absence
  }
]
```

## 3. Ключевые алгоритмы

### Парсинг JSON
Использован метод рекурсивного спуска.
Пример интерфейса:
```cpp
// Парсинг строки в DOM-дерево
static Value parse(const std::string& content);
// Сериализация обратно в строку с отступами
static std::string stringify(const Value& value, int indent = 0);
```

### Расчет времени
Для корректного вычисления времени пребывания используется `mktime` с явным отключением летнего времени (`tm_isdst = -1`).
Записи сортируются хронологически. Прогул (`absence`) сбрасывает счетчик текущей сессии. Пара `in` -> `out` добавляет разницу к сумме часов.

## 4. Обработка ошибок и UX
Реализован принцип "Graceful Degradation":
1.  **Битый JSON:** Программа сообщает позицию ошибки, но не падает.
2.  **Битые данные:** Записи с неверным форматом даты или типа игнорируются при валидации (выводится предупреждение), остальные данные обрабатываются.
3.  **Ввод пользователя:** Реализована защита от бесконечного цикла при вводе букв вместо цифр в меню (`cin.clear()`, `cin.ignore()`).
4.  **Unicode:** Использована WinAPI функция `SetConsoleOutputCP(65001)` и кастомная функция выравнивания таблиц `u8_adjust` для корректного отображения таблиц с кириллицей.

## 5. Результаты тестов
- **Unit-тесты:** Пройдены успешно (парсинг примитивов, вложенных структур, экранирования). См. `docs/tests_log.txt`.
- **Интеграционные тесты:** Проверена генерация файла на 500k записей и его последующее чтение. Ошибок кодировки не выявлено.

## 6. Выводы
Задача выполнена. Получено работоспособное приложение, способное обрабатывать большие объемы данных. В ходе работы решены проблемы совместимости кодировок в Windows и освоены методы профилирования через `std::chrono`.
```
